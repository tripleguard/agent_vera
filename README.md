# Vera — Голосовой агент для Windows

Полностью локальный голосовой агент с оффлайн-распознаванием речи и локальной моделью LLM.

## Содержание
- [О проекте](#о-проекте)
- [Возможности](#возможности)
- [Системные требования](#системные-требования)
- [Установка](#установка)
- [Быстрый старт](#быстрый-старт)
- [Полный справочник команд](#полный-справочник-команд)
- [Как работает веб-поиск](#как-работает-веб-поиск)
- [Конфигурация](#конфигурация)
- [Структура проекта](#структура-проекта)
- [Благодарности](#Благодарности)
- [Устранение неполадок](#устранение-неполадок)
- [FAQ](#faq)

## О проекте

Vera — локальный голосовой агент для Windows, работающий без передачи данных в облако. Все вычисления выполняются на компьютере пользователя:

- Распознавание речи: Vosk (оффлайн)
- Модель LLM: Ваша локальная (при разработке использовалась Qwen 3 1.7B)
- Синтез речи: pyttsx3

Важно: агент может ошибаться. Проверяйте критически важные данные, включая результаты веб-поиска, курсы валют, погодные данные и статистику.

Вы можете скачать агента на сайте https://agentvera.ru

## Возможности

| Категория | Функции |
|----------|---------|
| Голосовое управление | Активация по слову, офлайн STT, синтез речи |
| Приложения | Запуск и закрытие программ |
| Окна | Управление окнами |
| Файлы | Поиск и открытие файлов и папок |
| Веб | Поиск, погода, курсы валют |
| Продуктивность | Таймеры, напоминания, задачи |
| Система | Громкость, яркость, скриншоты |
| Мультизадачность | Несколько команд в одном запросе |

## Системные требования

| Компонент | Минимум | Рекомендуется |
|-----------|---------|---------------|
| ОС | Windows 10 x64 | Windows 11 x64 |
| Python | 3.10 | 3.11+ |
| RAM | 4 ГБ | 8+ ГБ |
| Диск | 2 ГБ | 4 ГБ SSD |
| Микрофон | Любой | USB или качественный встроенный |

## Установка

### Шаг 1: Клонирование

```bash
git clone https://github.com/tripleguard/agent_vera.git
cd agent_vera
```

### Шаг 2: Зависимости

```bash
pip install -r requirements.txt
```

### Шаг 3: Установка llama-cpp-python (Windows)

Установите Visual C++ Build Tools, затем:

```bash
pip install --upgrade pip setuptools wheel
pip install llama-cpp-python
```

### Шаг 4: Модели

**Vosk:**
1. Скачайте модель `vosk-model-small-ru-0.22`
2. Распакуйте её в корень проекта

**LLM:**
1. Скачайте модель GGUF (например, Q4_K_M)
2. Поместите файл в корень проекта (модель автоматически определяется агентом)
3. Либо укажите путь в `data/config.json`


## Быстрый старт

```bash
python -m main.agent
```

Последовательность:
1. Дождитесь сообщения «Система готова»
2. Скажите слово активации
3. Произнесите команду

Консольные команды:

| Команда | Описание |
|---------|----------|
| /help | Справка |
| /color green | Цвет консоли |
| /mute / /unmute | Управление микрофоном |
| /exit | Завершение работы |


## Полный справочник команд

### Приложения

```
Вера, открой хром
Вера, закрой телеграм
Вера, запусти калькулятор
```

Агент использует нечёткий поиск названий программ.

### Окна

```
Вера, сверни окно
Вера, разверни браузер
Вера, переключись на телеграм
```

### Файлы и папки

```
Вера, открой файл отчет
Вера, найди файл резюме
Вера, открой папку проект
```

Поиск выполняется в стандартных пользовательских каталогах.

### Системные настройки

Громкость:

```
Вера, громкость 5
Вера, громкость 75 процентов
```

Яркость:

```
Вера, яркость 7
```

Прочее:

```
Вера, сделай скриншот
Вера, какой мой IP
```

### Питание

```
Вера, выключи компьютер
Вера, перезагрузи через час
Вера, спящий режим
```

Без подтверждения выполняются только немедленные команды.

### Время и напоминания

```
Вера, который час
Вера, таймер 10 минут
Вера, напомни через полчаса позвонить
Вера, удали таймер
```

### Погода

```
Вера, погода в Москве
```

Источник данных: Яндекс.Погода (парсинг публичной страницы).

### Курсы валют

```
Вера, курс доллара
```

Источник: ЦБ РФ (cbr-xml-daily.ru).

### Веб-поиск и Википедия

```
Вера, найди информацию о Python
Вера, кто такой Эйнштейн
Вера, открой ютуб
```

Агент выполняет поиск через Brave + DDG Lite, извлекает текст, затем формирует краткий ответ.

## Как работает веб-поиск

Этапы:
1. Запрос через Brave + DDGLite
2. Получение списка ссылок
3. Загрузка страниц
4. Очистка текста
5. Суммаризация LLM

Ограничения:
- Возможны блокировки при частых запросах
- Некоторые сайты защищены от парсинга
- Модель может искажать информацию

## Конфигурация

Файл: `data/config.json`

Основные параметры:

| Параметр | Описание |
|----------|----------|
| activation_word | Слово активации |
| silence_timeout | Таймаут тишины |
| tts.voice_index | Голос Windows |
| tts.rate | Скорость речи |
| sites | Алиасы для сайтов |

## Структура проекта

```
main/                  Ядро агента
web/                   Веб-модули
user/                  Данные пользователя
data/                  Конфигурация и сохранения
vosk-model/            Модель распознавания речи
*.gguf                 Модель LLM
run_vera.py            Точка входа
vera.spec              Конфигурация PyInstaller
build.bat              Скрипт сборки
```

## Сборка EXE

Для создания автономного исполняемого файла:

### Требования
- Python 3.10+
- PyInstaller (`pip install pyinstaller`)
- Все зависимости из `requirements.txt`

### Шаги сборки

1. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   pip install pyinstaller
   ```

2. **Запустите сборку:**
   ```bash
   build.bat
   ```
   Или вручную:
   ```bash
   pyinstaller vera.spec
   ```

3. **Результат:** исполняемый файл появится в папке `dist/Vera/Vera.exe`

### Что включается в сборку

- `run_vera.py` — точка входа приложения
- `vera.spec` — конфигурация PyInstaller (пути к моделям, иконка, скрытые импорты)
- Модель Vosk копируется автоматически
- LLM модель (*.gguf) должна лежать рядом с exe или путь указан в `config.json`

### Важно

- При первом запуске exe создаётся папка `data/` рядом с исполняемым файлом
- Модель LLM не включается в сборку из-за размера — положите её рядом с exe
- Иконка `vera.ico` должна быть в корне проекта

## Устранение неполадок

### Vosk не загружается
Проверьте наличие директории `vosk-model-small-ru-0.22`.

### LLM не загружается
Проверьте путь до GGUF и корректность файла.

### Нет звука
Проверьте корректность значения `tts.voice_index`.

### Микрофон не работает
Проверьте настройки устройства в Windows.

## FAQ

**Передает ли агент данные в интернет?**  
Нет, кроме веб-поиска, погоды и курсов валют. STT и LLM работают локально.

**Можно ли изменить слово активации?**  
Да, в `config.json`.

**Почему агент не реагирует?**  
Проверьте работу микрофона и состояние `/mute`.

**Можно ли использовать GPU?**  
Да, если установить llama-cpp-python с поддержкой CUDA.

## Благодарности

- [Георгию Герганову](https://github.com/ggerganov) — за вклад в развитие локальных языковых моделей и технологий, лежащих в основе экосистемы LLM.
- [Андрею Abetlen](https://github.com/abetlen) — за создание и поддержку проекта **llama-cpp-python**, позволившего интегрировать локальную LLM в Vera.

## Лицензии и ссылки

Vosk: https://alphacephei.com/vosk  
llama-cpp-python: https://github.com/abetlen/llama-cpp-python 
